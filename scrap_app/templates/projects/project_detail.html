<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
  <title>Project Details</title>
  {% load static %}
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
  <meta content="width=device-width; initial-scale=1.0; maximum-scale=1.0;   user-scalable=0;" name="viewport">
  <link rel="stylesheet" type="text/css" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="//cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" ></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" ></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.js" integrity="sha512-zP5W8791v1A6FToy+viyoyUUyjCzx+4K8XZCKzW28AnCoepPNIXecxh9mvGuy3Rt78OzEsU+VCvcObwAMvBAww==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="//cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js" integrity="sha512-efUTj3HdSPwWJ9gjfGR71X9cvsrthIA78/Fvd/IN+fttQVy7XWkOAXb295j8B3cmm/kFKVxjiNYzKw9IQJHIuQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.blockUI/2.70/jquery.blockUI.min.js" integrity="sha512-eYSzo+20ajZMRsjxB6L7eyqo5kuXuS2+wEbbOkpaur+sA2shQameiJiWEzCIDwJqaB0a4a6tCuEvCOBHUg3Skg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.js"></script>
  <link rel="stylesheet" href="{%static 'css/project_details.css'%}" >

  <script> $(document).ready( function () {
    $('#myTable').DataTable();
  } );</script>

</head>
<body>

<div id="domMessage" style="display:none;">
	<img src="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/0.16.1/images/loader-large.gif" /><br/>
    Updating Data
</div>


<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="#">Protonshub Hour Tracker</a>
    </div>
    <ul class="nav navbar-nav">
      <li class="active"><a href="#">Projects</a></li>

      {% if request.user.is_superuser %}
      <li><a href="{% url 'user_detail' %}">Employees</a></li>

      {% endif %}
    </ul>
    <ul class="nav navbar-nav navbar-right">
      <li><a href="{% url 'logout' %}"><span class="glyphicon glyphicon-log-in"></span> Logout</a></li>
    </ul>
  </div>
</nav>







<div class="container">
 {% if request.user.is_superuser %}
<label>Holidays: </label>

  <div class="input-group">
    <div class="date-container">

  <input type="text" class="form-control date" placeholder="Pick the holidays" id = 'dates'>

  <span class="input-group-btn">
    <button class="btn btn-default" type="submit" id="submit" onClick="display()">Save Holidays !</button>
  </span>
</div><!-- /input-group -->


</div>


  <center><h2>Project Details</h2>
<!--  <p>Here you get the details about the Projects</p>-->
  </center>
  {% endif %}
{% if not request.user.is_superuser %}
  <center><h2>Your Project Details</h2></center>
<!--  <p>Here you get the details about the Projects:</p></center>-->
    <br>
  {% endif %}

<div>



  {% if request.user.is_superuser %}

  <br>


<button type='submit' id = "refresh" name = "refresh" style="float: right" "> Refresh Data</button>

  <br>

  <a href = "{% url 'project' %}"><h5>+ Add Project</h5></a>
<!--  <a><h5 align="right">Refresh Data</h5></a>-->


<!--  <p>Here you get the details about the Projects:</p></center>-->
    <br>
  {% endif %}
</div>



 {% if request.user.is_superuser %}
<h5>
<label for="cycles">Billing Cycle:</label>
  <select id="cycles">
   <option value="0" selected>Billing Cycle</option>
    {% for cycles in billing_cycles %}
      <option value="{{cycles}}">{{cycles}}</option>
   {% endfor %}
</select>

<label for="project">Project:</label>
  <select id="project">
   <option value="0" selected>Projects</option>
    {% for project in project_name_list %}
      <option value="{{project}}">{{project}}</option>
   {% endfor %}
</select>


<label for="developer">Developer:</label>
  <select id="developer">
   <option value="0" selected>Developers</option>
    {% for developer in developer_name_list %}
      <option value="{{developer}}">{{developer}}</option>
   {% endfor %}
</select>


  <label for="actual_developer">Actual Developer:</label>
  <select id="actual_developer">
   <option value="0" selected>Actual Developer</option>
    {% for ac_dev in actual_developer %}
      <option value="{{ac_dev.id}}">{{ac_dev.first_name}} {{ac_dev.last_name}}</option>
   {% endfor %}
</select>

  {% endif %}

</h5>

  <br><br>



    <div id="project_table">
  <table class="table table-hover">
    <thead>
      <tr>
        <th>Sr no.</th>
        {% if request.user.is_superuser %}
        <th>Actual Developer Name</th>
        <th>Screen Developer Name</th>
        {% endif %}
        <th>Project Name</th>
        <th>Project Hours</th>
        <th>Expected Cycle Hours</th>
<!--        <th>Project Start Date</th>-->
<!--        <th>Project End Date</th>-->
<!--        <th>Expected Hours</th>-->
        {% if not request.user.is_superuser %}
         <th>Month Cycle</th>
        {% endif %}
        {% if request.user.is_superuser %}
        <th>Email</th>
        {% endif %}
<!--          <th>Daily Hours</th>-->

      </tr>
    </thead>
    <tbody>
      {% for project in project_list %}

      {% if project.cycle_hour_diff <= 28800 %}
      <tr bgcolor="yellowgreen">
        {% elif project.cycle_hour_diff > 28800 and project.cycle_hour_diff <= 57600 %}
      <tr bgcolor="yellow">
        {% else %}
      <tr bgcolor="salmon">
        {% endif %}

        <td>{{ forloop.counter }}</td>
        <!-- <td>{{employe.employee.id}}</td> -->
        {% if request.user.is_superuser %}
<!--        <td>{{project.id}}</td>-->
        <td>{{project.actual_developer.first_name}} {{project.actual_developer.last_name}}</td>
        <td>{{project.developer_name}}</td>
        {% endif %}

        <td>{{project.projects_name}}</td>
        <td>{{project.project_hours}}</td>
        <td>{{project.expected_cycle_hours}}</td>



        {% if not request.user.is_superuser %}
         <td>{{project.Month_Cycle}}</td>
        {% endif %}
        {% if request.user.is_superuser %}
        <td>{{project.developer_email}}</td>
        <td><a href="#" onclick="confirmationBox('{{project.id}}');">Delete</a></td>
<!--        <td> <a href="/update/{{ project.id }}">Edit</a></td>-->
        <td><a href="/updateproject/{{project.id}}" >Update</a></td>
        {% endif %}
      </tr>

      {% endfor %}
    </tbody>
  </table>
        </div>
</div>



</body>



<script type="text/javascript">

  $(document).ready(function() {


        $('.date').datepicker({
          multidate: true,
            format: 'dd-mm-yyyy'
        });


         $('#cycles').change(function(){
             var cycles = $('#cycles').val();
             var developer = $('#developer').val();
             var project = $('#project').val();
             var actual_developer= $('#actual_developer').val();
             console.log(actual_developer);
             if (cycles != 0) {
             sortingRecentFiles(cycles,project, developer, actual_developer);
             }
         });

          $('#developer').change(function(){
             var developer = $('#developer').val();
             var cycles = $('#cycles').val();
             var project = $('#project').val();
             var actual_developer = $('#actual_developer').val();
             if (developer != 0) {
             sortingRecentFiles(cycles,project, developer, actual_developer);
             }
          });

         $('#project').change(function(){
             var project = $('#project').val();
             var developer = $('#developer').val();
             var cycles = $('#cycles').val();
             var actual_developer = $('#actual_developer').val();
             if (project != 0) {
             sortingRecentFiles(cycles,project, developer, actual_developer);
             }
         });

         $('#actual_developer').change(function(){
             var developer = $('#developer').val();
             var cycles = $('#cycles').val();
             var project = $('#project').val();
             var actual_developer = $('#actual_developer').val();
             if (actual_developer != 0) {
             sortingRecentFiles(cycles,project, developer, actual_developer)
             }
         });
      });

      function sortingRecentFiles(billing, project, developer, actual_developer){
         postdata = {billing:billing, project:project, developer:developer, actual_developer:actual_developer, 'csrfmiddlewaretoken': "{{ csrf_token }}"}
         console.log(actual_developer);
         $.ajax({
                url: "/dropdown/",
                type: "POST",
                data: postdata,
                success: function(data) {
                }
            });
            }
    function confirmationBox(id){
    var retVal = confirm("Do you really want to delete it?");
               if( retVal == true ) {
               Delete_project(id)

                  return true;
               } else {

                  return false;
               }

}

      function Delete_project(id){
         postdata = {id:id, 'csrfmiddlewaretoken': "{{ csrf_token }}"}
         $.ajax({
                url: "/deleteproject/",
                type: "POST",
                data: postdata,
                success: function(data) {

                  if (data.status_code == 200){
                  $.notify(data.status_message,{'globalPosition':'top centre','className': 'success', autoHideDelay: 3000})
                      setInterval(function(){
                      window.location.reload();
                  },1500);
                    }
                    else{
                      $.notify(data.status_message,{'globalPosition':'top centre','className': 'error', autoHideDelay: 3000})
                    }
                }
            });
            }

function update_project(id){
         postdata = {id:id, 'csrfmiddlewaretoken': "{{ csrf_token }}"}
         $.ajax({
                url: "/updateproject/",
                type: "POST",
                data: postdata,
                success: function(data) {
                }
            });
            }

function display()
        {
              dates=document.getElementById("dates").innerHTML = document.getElementById("dates").value;
              console.log(dates);

              postdata = {dates:dates, 'csrfmiddlewaretoken': "{{ csrf_token }}"}
              $.ajax({
                url: "/saveholidays/",
                type: "POST",
                data: postdata,
                success: function(data) {
                }
            });
            document.getElementById("dates").value = "";
        }


$("#refresh").click(function(){
  $.blockUI({
		css: {
			border: '5px solid #3c8dbc',
			borderRadius: '5px',
			padding: '20px 0'

		},
        message: $('#domMessage')
    });

   $.ajax({
    type: "GET",
    url: "/project_detail_refresh/",
    success: function(data){
       console.log(data);
       $.unblockUI();
       window.location.reload();
    }
  });
});



</script>



</html>