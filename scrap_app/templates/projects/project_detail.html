<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
  <title>Project Details</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

  <meta content="width=device-width; initial-scale=1.0; maximum-scale=1.0;   user-scalable=0;" name="viewport">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="//cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">

  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.js" integrity="sha512-zP5W8791v1A6FToy+viyoyUUyjCzx+4K8XZCKzW28AnCoepPNIXecxh9mvGuy3Rt78OzEsU+VCvcObwAMvBAww==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="//cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js" integrity="sha512-efUTj3HdSPwWJ9gjfGR71X9cvsrthIA78/Fvd/IN+fttQVy7XWkOAXb295j8B3cmm/kFKVxjiNYzKw9IQJHIuQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script> $(document).ready( function () {
    $('#myTable').DataTable();
  } );</script>
</head>
<body>
<!--{% if request.user.is_superuser %}-->
<!--  <button  type="button" class="btn btn-danger" onclick="window.location.href='{% url 'project' %}'">Add Project</button >-->
<!--  <button  type="button" class="btn btn-success" onclick="window.location.href='{% url 'register' %}'">User Register</button>-->
<!--{% endif %}-->
<!--<button  type="button" class="btn btn-primary" onclick="window.location.href='{% url 'logout' %}'">Logout</button>-->

<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="#">Protonshub Hour Tracker</a>
    </div>
    <ul class="nav navbar-nav">
      <li class="active"><a href="#">Projects</a></li>
<!--      <li><a href="#">Page 1</a></li>-->
      {% if request.user.is_superuser %}
      <li><a href="{% url 'user_detail' %}">Employees</a></li>
      {% endif %}
    </ul>
    <ul class="nav navbar-nav navbar-right">
<!--      <li><span class="glyphicon glyphicon-user"></span>"{{request.user.user_name}}"</li>-->
      <li><a href="{% url 'logout' %}"><span class="glyphicon glyphicon-log-in"></span> Logout</a></li>
    </ul>
  </div>
</nav>

<div class="container">
  {% if request.user.is_superuser %}
  <center><h2>Employee Project Details for</h2>
  <p>Here you get the details about the Projects:</p></center><br>
  {% endif %}
{% if not request.user.is_superuser %}
  <center><h2>Your Project Details</h2></center>
<!--  <p>Here you get the details about the Projects:</p></center>-->
    <br>
  {% endif %}

<div  >


  {% if request.user.is_superuser %}

  <br>


<button type='submit' id = "refresh" name = "refresh" style="float: right"; "> Refresh Data</button>

  <br>

  <a href = "{% url 'project' %}"><h5>+ Add Project</h5></a>
<!--  <a><h5 align="right">Refresh Data</h5></a>-->


<!--  <p>Here you get the details about the Projects:</p></center>-->
    <br><br>
  {% endif %}
</div>



    {% if request.user.is_superuser %}
<h5>
<label for="cycles">Billing Cycle:</label>
  <select id="cycles">
   <option value="0" selected>Billing Cycle</option>
    {% for cycles in billing_cycles %}
      <option value="{{cycles}}">{{cycles}}</option>
   {% endfor %}
</select>

<label for="project">Project:</label>
  <select id="project">
   <option value="0" selected>Projects</option>
    {% for project in project_name_list %}
      <option value="{{project}}">{{project}}</option>
   {% endfor %}
</select>

<label for="developer">Developer:</label>
  <select id="developer">
   <option value="0" selected>Developers</option>
    {% for developer in developer_name_list %}
      <option value="{{developer}}">{{developer}}</option>
   {% endfor %}
</select>

  <label for="actual_developer">Actual Developer:</label>
  <select id="actual_developer">
   <option value="0" selected>Actual Developer</option>
    {% for ac_dev in actual_developer %}
      <option value="{{ac_dev.id}}">{{ac_dev.first_name}} {{ac_dev.last_name}}</option>
   {% endfor %}
</select>

  {% endif %}

</h5>

  <br><br>



    <div id="project_table">
  <table class="table table-hover">
    <thead>
      <tr>
        <th>Sr no.</th>
        {% if request.user.is_superuser %}
        <th>Actual Developer Name</th>
        <th>Screen Developer Name</th>
        {% endif %}
        <th>Project Name</th>
        <th>Project Hours</th>
<!--        <th>Project Start Date</th>-->
<!--        <th>Project End Date</th>-->
<!--        <th>Expected Hours</th>-->
        {% if request.user.is_superuser %}
        <th>Email</th>
        {% endif %}
<!--          <th>Daily Hours</th>-->

      </tr>
    </thead>
    <tbody>
      {% for project in project_list %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <!-- <td>{{employe.employee.id}}</td> -->
        {% if request.user.is_superuser %}
<!--        <td>{{project.id}}</td>-->
        <td>{{project.actual_developer.first_name}} {{project.actual_developer.last_name}}</td>
        <td>{{project.developer_name}}</td>
        {% endif %}

        <td>{{project.projects_name}}</td>
<!--        <td>{{employe.project_start_date}}</td>-->
<!--        <td>{{      employe.project_end_date}}</td>-->
        <td>{{project.project_hours}}</td>
<!--        <td>{{employe.project_left_hrs}}</td>-->
        {% if request.user.is_superuser %}
        <td>{{project.developer_email}}</td>
        <td><a href="#" onclick="confirmationBox('{{project.id}}');">Del</a></td>
<!--        <td> <a href="/update/{{ project.id }}">Edit</a></td>-->
        <td><a href="/updateproject/{{project.id}}" >Update</a></td>
        {% endif %}
      </tr>

      {% endfor %}
    </tbody>
  </table>
        </div>
</div>



</body>



<script type="text/javascript">
  $(document).ready(function() {
         $('#cycles').change(function(){
             var cycles = $('#cycles').val();
             var developer = $('#developer').val();
             var project = $('#project').val();
             var actual_developer= $('#actual_developer').val();
             console.log(actual_developer);
             if (cycles != 0) {
             sortingRecentFiles(cycles,project, developer, actual_developer);
             }
         });

          $('#developer').change(function(){
             var developer = $('#developer').val();
             var cycles = $('#cycles').val();
             var project = $('#project').val();
             var actual_developer = $('#actual_developer').val();
             if (developer != 0) {
             sortingRecentFiles(cycles,project, developer, actual_developer);
             }
          });

         $('#project').change(function(){
             var project = $('#project').val();
             var developer = $('#developer').val();
             var cycles = $('#cycles').val();
             var actual_developer = $('#actual_developer').val();
             if (project != 0) {
             sortingRecentFiles(cycles,project, developer, actual_developer);
             }
         });

         $('#actual_developer').change(function(){
             var developer = $('#developer').val();
             var cycles = $('#cycles').val();
             var project = $('#project').val();
             var actual_developer = $('#actual_developer').val();
             if (actual_developer != 0) {
             sortingRecentFiles(cycles,project, developer, actual_developer)
             }
         });
      });

      function sortingRecentFiles(billing, project, developer, actual_developer){
         postdata = {billing:billing, project:project, developer:developer, actual_developer:actual_developer, 'csrfmiddlewaretoken': "{{ csrf_token }}"}
         console.log(actual_developer);
         $.ajax({
                url: "/dropdown/",
                type: "POST",
                data: postdata,
                success: function(data) {
<!--                  $.unblockUI()-->
<!--                  if (data.status_code == 200){-->
<!--                  }-->
<!--                  else{-->
<!--                  }-->
                }
            });
            }
    function confirmationBox(id){
    var retVal = confirm("Do you really want to delete it?");
               if( retVal == true ) {
               Delete_project(id)

                  return true;
               } else {

                  return false;
               }

}

      function Delete_project(id){
         postdata = {id:id, 'csrfmiddlewaretoken': "{{ csrf_token }}"}
         $.ajax({
                url: "/deleteproject/",
                type: "POST",
                data: postdata,
                success: function(data) {

                  if (data.status_code == 200){
                  $.notify(data.status_message,{'globalPosition':'top centre','className': 'success', autoHideDelay: 3000})
                      setInterval(function(){
                      window.location.reload();
                  },1500);
                    }
                    else{
                      $.notify(data.status_message,{'globalPosition':'top centre','className': 'error', autoHideDelay: 3000})
                    }
                }
            });
            }

function update_project(id){
         postdata = {id:id, 'csrfmiddlewaretoken': "{{ csrf_token }}"}
         $.ajax({
                url: "/updateproject/",
                type: "POST",
                data: postdata,
                success: function(data) {
                }
            });
            }


$("#refresh").click(function(){ $.ajax({
    type: "GET",
    url: "http://localhost:8000/project_detail_refresh/",
    success: function(data){
       console.log(data);
       window.location.href = "http://localhost:8000/project_detail/"
    }
  });
});









</script>



</html>